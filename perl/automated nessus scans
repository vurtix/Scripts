#!/usr/bin/perl

use strict;
use warnings;

use LWP::UserAgent;
use HTTP::Request::Common;

# Set up the Nessus URL and login credentials
my $url = "https://nessus.example.com/login";
my $username = "nessus_user";
my $password = "nessus_password";

# Create a new user agent and log in to Nessus
my $ua = LWP::UserAgent->new;
my $response = $ua->request(POST $url, [
    login => $username,
    password => $password
]);

# Check for a successful login
if ($response->is_success) {
    print "Successfully logged in to Nessus.\n";
}
else {
    print "Error logging in to Nessus: " . $response->status_line . "\n";
    exit;
}

# Set the parameters for the scan
my $target = "192.168.1.0/24";
my $policy = "basic";

# Start the scan
$response = $ua->request(POST $url, [
    action => "scan",
    target => $target,
    policy => $policy
]);

# Check for a successful scan start
if ($response->is_success) {
    print "Scan successfully started.\n";
}
else {
    print "Error starting scan: " . $response->status_line . "\n";
    exit;
}

# Wait for the scan to complete
sleep(60);

# Retrieve the scan results
$response = $ua->request(GET $url);

# Check for a successful result retrieval
if ($response->is_success) {
    print "Scan results successfully retrieved.\n";
}
else {
    print "Error retrieving scan results: " . $response->status_line . "\n";
    exit;
}

# Process the results as needed
